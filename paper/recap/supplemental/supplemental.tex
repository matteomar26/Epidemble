\documentclass[a4paper, amsfonts, amssymb, amsmath, reprint, showkeys, nofootinbib, twoside, floatfix, pre,superscriptaddress, onecolumn]{revtex4-2}

\usepackage[utf8]{inputenc}
% \usepackage{geometry}
% \geometry{verbose,lmargin=5cm,rmargin=2cm}
\usepackage[left=23mm,right=13mm,top=35mm,columnsep=15pt]{geometry} 
\setcounter{secnumdepth}{3}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{esint}
\usepackage[unicode=true, pdfusetitle, bookmarks=true, bookmarksnumbered=false, bookmarksopen=false, breaklinks=false, pdfborder={0 0 1}, backref=false, colorlinks=false]{hyperref}
%\usepackage[margin=0.5cm]{subcaption}
\usepackage{graphicx}
\graphicspath{ {./images/} }
\usepackage{xcolor}

\makeatletter
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.
%\pdfoutput=1
%
% Document outline for use when preparing LaTeX manuscripts
% for Elsevier Major Reference Works
% To run with LaTeX $2\epsilon$
%
% MJR, October 2003
%

\usepackage{makeidx}\usepackage{amsfonts}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\makeatother

\begin{document}
\title{Supplemental}

\maketitle

\section{BP equations}
\label{app:BP_derivation}

\subsection{Clamping} In the numerical resolution of the above equation, it will be convenient to introduce a horizon time $\theta$ above which the epidemic evolution is not observed.
This results in a modification of the functions $\psi^*, \psi$:
\begin{align}
\begin{aligned}
	\psi^*(\tau_i,\underline{\tau}_{\partial i},x_i^0,\{s_{ji}\}) &= \mathbb{I}[\tau_i=\delta_{x_i^0,S}\min(\theta,\min_{l\in\partial i}(\tau_l+s_{li}))] \ ,\\
	\psi(t_i,\underline{t}_{\partial i}) &=\sum_{x_i^0}\gamma(x_i^0)\sum_{s_{ji}}w'(s_{ji})\mathbb{I}[t_i=\delta_{x_i^0,S}\min(\theta,\min_{l\in\partial i}(t_l+s_{li}))] \ .
\end{aligned}
\end{align}

\subsection{Simplifications}
In order to simplify the BP equations, we will start by writing the functions $\psi^*,\psi$ in a simpler way:
\begin{align}
	\psi^*(\tau_i^{(j)}, \underline{\tau}_{\partial i}^{(i)},\{s_{li}\}_{l\in\partial i},x_i^0) &= \delta_{x_i^0,I}\delta_{\tau_i^{(j)},0} + \delta_{x_i^0,S}\prod_{l\in\partial i}\mathbb{I}[\tau_i^{(j)}\leq\tau_l^{(i)}+s_{li}] - \delta_{x_i^0,S}\mathbb{I}[\tau_i^{(j)}<\theta]\prod_{l\in\partial i}\mathbb{I}[\tau_i^{(j)}<\tau_l^{(i)}+s_{li}]
\end{align}
and:
\begin{align}
\begin{aligned}
	\psi(t_i^{(j)}, \underline{t}_{\partial i}^{(i)}) &= \sum_{x_i^0}\gamma(x_i^0)\sum_{\{s_{li}\}_{l\in\partial i}}\prod_{l\in\partial i}w'(s_{li})\mathbb{I}[t_i^{(j)}=\delta_{x_i^0,S}\min(\theta,t_l^{(i)}+s_{li})] \\
	&= \gamma \delta_{\tau_i^{(j)},0} + (1-\gamma)\left[\prod_{l\in\partial_i}\left(\sum_{s=1}^{\infty}w'(s)\mathbb{I}[t_i^{(j)}\leq t_l^{(i)}+s]\right) - \mathbb{I}[\tau_i^{(j)}<\theta]\prod_{l\in\partial_i}\left(\sum_{s=1}^{\infty}w'(s)\mathbb{I}[t_i^{(j)}< t_l^{(i)}+s]\right)\right]\\
	&= \gamma \delta_{\tau_i^{(j)},0} + (1-\gamma)\left[\prod_{l\in\partial_i}a(t_i^{(j)}-t_l^{(i)}-1) - \mathbb{I}[\tau_i^{(j)}<\theta]\prod_{l\in\partial_i}a(t_i^{(j)}-t_l^{(i)})\right]\\
	&= \gamma(t_i^{(j)})\left(\prod_{l\in\partial i} a(t_i^{(j)}-t_l^{(i)}-1) - \phi(t_i^{(j)})\prod_{l\in\partial i}a(t_i^{(j)}-t_l^{(i)}) \right)
\end{aligned}
\end{align}
where we have defined:
\begin{align}
\begin{aligned}
	a(t) &= (1-\lambda)^{tH(t)} \\
	\gamma(t) &= \begin{cases}
	\gamma & \text{if} \quad t=0\\
	1-\gamma & \text{if} \quad t>0
	\end{cases} \ .\\
	\phi(t) &= \begin{cases}
	0 & \text{if} \quad t=0 \ \text{or} \ t=\theta\\
	1 & \text{if} \quad 0<t<\theta
	\end{cases} \ .
\end{aligned}	
\end{align}
with $H(t)$ the Heaviside step function, with $H(0)=0$.
We also notice that the function $\Psi$ constraints the planted and inferred times of the incoming messages to the equality: $\tau_i^{(k)}=\tau_i^{(j)}$, and $t_i^{(k)}=t_i^{(j)}$ for all $k\in\partial i \setminus j$.
We can now re-write the first BP equation with the expression of $\psi^*, \psi$:
\begin{align}
\begin{aligned}
	\nu_{\Psi_i\to j}(T_{ij}) &=\frac{\gamma(t_i^{(j)})\xi(\tau_i^{(j)},t_i^{(j)},c_i)}{z_{\Psi_i\to j}}\left(
	a(t_i^{(j)}-t_j^{(i)}-1)\delta_{x_i^0,I}\delta_{\tau_i^{(j)},0}\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)}-1)\sum_{\tau_k^{(i)}}\mu_{k\to \Psi_i}(T_{ki})\right]\right.\\
	+&a(t_i^{(j)}-t_j^{(i)}-1)\delta_{x_i^0,S}\mathbb{I}[\tau_i^{(j)}\leq\tau_j^{(j)}+s_{ji}]\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)}-1)\sum_{\tau_k^{(i)}}\mu_{k\to \Psi_i}(T_{ki})\mathbb{I}[\tau_i^{(j)}\leq\tau_k^{(i)}+s_{ki}]\right]\\
	-&a(t_i^{(j)}-t_j^{(i)}-1)\delta_{x_i^0,S}\mathbb{I}[\tau_i^{(j)}<\theta]\mathbb{I}[\tau_i^{(j)}<\tau_j^{(j)}+s_{ji}]\\
	 &\qquad\qquad\qquad\times\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)}-1)\sum_{\tau_k^{(i)}}\mu_{k\to \Psi_i}(T_{ki})\mathbb{I}[\tau_i^{(j)}<\tau_k^{(i)}+s_{ki}]\right]\\
	-&\phi(t_i^{(j)})a(t_i^{(j)}-t_j^{(i)})\delta_{x_i^0,I}\delta_{\tau_i^{(j)},0}\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)})\sum_{\tau_k^{(i)}}\mu_{k\to \Psi_i}(T_{ki})\right]\\
	-&\phi(t_i^{(j)})a(t_i^{(j)}-t_j^{(i)})\delta_{x_i^0,S}\mathbb{I}[\tau_i^{(j)}\leq\tau_j^{(j)}+s_{ji}]\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)})\sum_{\tau_k^{(i)}}\mu_{k\to \Psi_i}(T_{ki})\mathbb{I}[\tau_i^{(j)}\leq\tau_k^{(i)}+s_{ki}]\right]\\
	+&\phi(t_i^{(j)})a(t_i^{(j)}-t_j^{(i)})\delta_{x_i^0,S}\mathbb{I}[\tau_i^{(j)}<\theta]\mathbb{I}[\tau_i^{(j)}<\tau_j^{(j)}+s_{ji}]\\
	&\left.\qquad\qquad\qquad\times\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)})\sum_{\tau_k^{(i)}}\mu_{k\to \Psi_i}(T_{ki})\mathbb{I}[\tau_i^{(j)}<\tau_k^{(i)}+s_{ki}]\right]\right)
\end{aligned}
\end{align}
where $T_{ki}=(\tau_k^{(i)},\tau_i^{(k)}=\tau_i^{(j)},t_k^{(i)},t_i^{(k)}=t_i^{(j)})$ due to the constraint on the incoming times. 

\subsection{Summation over the planted times}
We can see on the above equation that the r.h.s. depends on the planted time $\tau_j^{(i)}$ only through the sign:
\begin{align}
\label{eq:def_sigma_ji}
	\sigma_{ji} = 1+\text{sgn}(\tau_j^{(i)}-\tau_i^{(j)}+s_{ji})\,
\end{align}
with the convention that $\text{sgn}(0)=0$.
We therefore introduce the notation	:
\begin{align}
\label{eq:tilde_nu}
	\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)}, \sigma_{ji},t_i^{(j)},t_j^{(i)})=\nu_{\Psi_i\to j}(\tau_i^{(j)},\tau_j^{(i)},t_i^{(j)},t_j^{(i)})
\end{align}
for all $\tau_j^{(i)}$ such that $\sigma_{ji} = 1+\text{sgn}(\tau_j^{(i)}-\tau_i^{(j)}+s_{ji})$.
We also introduce the message:
\begin{align}
	\tilde{\mu}_{i\to \Psi_j}(\sigma_{ij},\tau_j^{(i)},t_i^{(j)},t_j^{(i)}) = \sum_{\tau_i^{(j)}}\mu_{i\to \Psi_j}(\tau_i^{(j)},\tau_j^{(i)},t_i^{(j)},t_j^{(i)})\mathbb{I}[\sigma_{ij}=1+\text{sgn}(\tau_i^{(j)}-\tau_j^{(i)}+s_{ij})]
\end{align}
With these definitions, the BP equation becomes:
\begin{align}
\begin{aligned}
	\tilde{\nu}_{\Psi_i\to j}(\widetilde{T}_{ij}) &=\gamma(t_i^{(j)})\xi(\tau_i^{(j)},t_i^{(j)},c_i)\left( a(t_i^{(j)}-t_j^{(i)}-1)\delta_{x_i^0,I}\delta_{\tau_i^{(j)},0}\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)}-1)\sum_{\sigma_{ki}=0}^2\tilde{\mu}_{k\to \Psi_i}(\widetilde{T}_{ki})\right]\right.\\
	+&a(t_i^{(j)}-t_j^{(i)}-1)\delta_{x_i^0,S}\mathbb{I}[\sigma_{ji}\in\{1,2\}]\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)}-1)\sum_{\sigma_{ki}=1}^2\tilde{\mu}_{k\to \Psi_i}(\widetilde{T}_{ki})\right]\\
	-&a(t_i^{(j)}-t_j^{(i)}-1)\delta_{x_i^0,S}\mathbb{I}[\tau_i^{(j)}<\theta]\mathbb{I}[\sigma_{ji}=2]\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)}-1)\tilde{\mu}_{k\to \Psi_i}(\sigma_{ki}=2,\tau_i^{(j)},t_k^{(i)},t_i^{(j)})\right]\\
	-&\phi(t_i^{(j)})a(t_i^{(j)}-t_j^{(i)})\delta_{x_i^0,I}\delta_{\tau_i^{(j)},0}\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)})\sum_{\sigma_{ki}=0}^2\tilde{\mu}_{k\to \Psi_i}(\widetilde{T}_{ki})\right]\\
	-&\phi(t_i^{(j)})a(t_i^{(j)}-t_j^{(i)})\delta_{x_i^0,S}\mathbb{I}[\sigma_{ji}\in\{1,2\}]\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)})\sum_{\sigma_{ki}=1}^2\tilde{\mu}_{k\to \Psi_i}(\widetilde{T}_{ki})\right]\\
	+&\left.\phi(t_i^{(j)})a(t_i^{(j)}-t_j^{(i)})\delta_{x_i^0,S}\mathbb{I}[\tau_i^{(j)}<\theta]\mathbb{I}[\sigma_{ji}=2]\prod_{k\in\partial i\setminus j}\left[\sum_{t_k^{(i)}}a(t_i^{(j)}-t_k^{(i)})\tilde{\mu}_{k\to \Psi_i}(\sigma_{ki}=2,\tau_i^{(j)},t_k^{(i)},t_i^{(j)})\right]\right)
\end{aligned}
\end{align}
where $\widetilde{T}_{ij} = (\tau_i^{(j)},\sigma_{ji},t_i^{(j)},t_j^{(i)})$, and $\widetilde{T}_{ki}=(\sigma_{ki}, \tau_i^{(k)}=\tau_i^{(j)}, t_k^{(i)},t_i^{(k)}=t_i^{(j)})$ for all $k\in\partial i \setminus j$.
In the above equation we have dropped the normalization factor $z_{\Psi_i\to j}$, since the message $\tilde{\nu}_{\Psi_i\to j}$ is not a probability but the value taken by the (normalized) BP message $\nu_{\Psi_i\to j}$ for any $\tau_j^{(i)}$ achieving the equality (\ref{eq:def_sigma_ji}).
The other BP equation becomes:
\begin{align}
\begin{aligned}
	\tilde{\mu}_{i\to \Psi_j}(\sigma_{ij},\tau_j^{(i)},t_i^{(j)},t_j^{(i)}) &= \sum_{\tau_i^{(j)}=0}^{\theta}\mu_{i\to \Psi_j}(\tau_i^{(j)},\tau_j^{(i)},t_i^{(j)},t_j^{(i)})\mathbb{I}[\sigma_{ij}=1+\text{sgn}(\tau_i^{(j)}-\tau_j^{(i)}+s_{ij})] \\
	&= \sum_{\tau_i^{(j)}=0}^{\theta}\nu_{\Psi_i\to j}(\tau_i^{(j)},\tau_j^{(i)},t_i^{(j)},t_j^{(i)})\mathbb{I}[\sigma_{ij}=1+\text{sgn}(\tau_i^{(j)}-\tau_j^{(i)}+s_{ij})] \\
	&= \sum_{\tau_i^{(j)}=0}^{\theta}\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)},\sigma_{ji}=1+\text{sgn}(\tau_j^{(i)}-\tau_i^{j}+s_{ji}),t_i^{(j)},t_j^{(i)})\mathbb{I}[\sigma_{ij}=1+\text{sgn}(\tau_i^{(j)}-\tau_j^{(i)}+s_{ij})]
\end{aligned}
\end{align}
which gives:
\begin{align}
\begin{aligned}
\left\{
\begin{array}{llllll}
	\tilde{\mu}_{i\to \Psi_j}(0,\tau_j^{(i)},t_i^{(j)},t_j^{(i)})&=\mathbb{I}[\tau_j-s_{ji}>0]\sum_{\tau_i^{(j)}=0}^{\tau_j^{(i)}-s_{ji}}\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)},\sigma_{ji}=2,t_i^{(j)},t_j^{(i)}) \\
	\tilde{\mu}_{i\to \Psi_j}(1,\tau_j^{(i)},t_i^{(j)},t_j^{(i)})&= \mathbb{I}[\tau_j-s_{ji}\geq 0]\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)}=\tau_j^{(i)}-s_{ji},\sigma_{ji}=2,t_i^{(j)},t_j^{(i)})\\	
	\tilde{\mu}_{i\to \Psi_j}(2,\tau_j^{(i)},t_i^{(j)},t_j^{(i)})&= \sum_{\tau_i^{(j)}=\zeta_{ij}^+}^{\theta}\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)},\sigma_{ji}=1+\text{sgn}(\tau_j^{(i)}-\tau_i^{j}+s_{ji}),t_i^{(j)},t_j^{(i)})\\
	&=\sum_{\tau_i^{(j)}=\zeta^+_i}^{\zeta^-_i}\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)},\sigma_{ji}=2,t_i^{(j)},t_j^{(i)}) \\
	&+ \mathbb{I}[\tau_j^{(i)}+s_{ji}\leq \theta]\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)}=\tau_j^{(i)}+s_{ji},\sigma_{ji}=1,t_i^{(j)},t_j^{(i)})\\
	&+ \mathbb{I}[\tau_j^{(i)}+s_{ji}<\theta]\sum_{\tau_i^{(j)}=\tau_j^{(i)}+s_{ji}+1}^\theta \tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)},\sigma_{ji}=0,t_i^{(j)},t_j^{(i)})
\end{array}
\right.
\end{aligned}
\end{align}
where $\zeta^+_i=\max(0,\tau_j^{(i)}-s_{ij}+1)$, and $\zeta^-_i=\min(\theta,\tau_j^{(i)}+s_{ji}-1)$.

\subsection{Summation over the inferred times}
In order to reduce further the space of variables over which the BP messages are defined, we define the following message:
\begin{align}
	\mu'_{i\to\Psi_j}(\sigma_{ij},\tau_j^{(i)},c_{ij},t_j^{(i)})=\sum_{t_i^{(j)}}\tilde{\mu}_{i\to\Psi_j}(\sigma_{ij},\tau_j^{(i)},t_i^{(j)},t_j^{(i)})a(t_j^{(i)}-t_i^{(j)}-c_{ij}) \ ,
\end{align}
with $c_{ij}\in\{0,1\}$.
Using this definition, the first BP equation becomes:
\begin{align}
\label{eq:BP_factor_to_variable}
\begin{aligned}
	\tilde{\nu}_{\Psi_i\to j}(\widetilde{T}_{ij}) &=\gamma(t_i^{(j)})\xi(\tau_i^{(j)},t_i^{(j)},c_i)\left( a(t_i^{(j)}-t_j^{(i)}-1)\delta_{x_i^0,I}\delta_{\tau_i^{(j)},0}\prod_{k\in\partial i\setminus j}\left[\sum_{\sigma_{ki}=0}^2 \mu'_{k\to \Psi_i}(\sigma_{ki},\tau_i^{(k)},c_{ki}=1,t_i^{(k)})\right]\right.\\
	+&a(t_i^{(j)}-t_j^{(i)}-1)\delta_{x_i^0,S}\mathbb{I}[\sigma_{ji}\in\{1,2\}]\prod_{k\in\partial i\setminus j}\left[\sum_{\sigma_{ki}=1}^2\mu'_{k\to \Psi_i}(\sigma_{ki},\tau_i^{(k)},c_{ki}=1,t_i^{(k)})\right]\\
	-&a(t_i^{(j)}-t_j^{(i)}-1)\delta_{x_i^0,S}\mathbb{I}[\tau_i^{(j)}<\theta]\mathbb{I}[\sigma_{ji}=2]\prod_{k\in\partial i\setminus j}\mu'_{k\to \Psi_i}(\sigma_{ki}=2,\tau_i^{(k)},c_{ki}=1,t_i^{(k)})\\
	-&\phi(t_i^{(j)})a(t_i^{(j)}-t_j^{(i)})\delta_{x_i^0,I}\delta_{\tau_i^{(j)},0}\prod_{k\in\partial i\setminus j}\left[\sum_{\sigma_{ki}=0}^2\mu'_{k\to \Psi_i}(\sigma_{ki},\tau_i^{(k)},c_{ki}=0,t_i^{(k)})\right]\\
	-&\phi(t_i^{(j)})a(t_i^{(j)}-t_j^{(i)})\delta_{x_i^0,S}\mathbb{I}[\sigma_{ji}\in\{1,2\}]\prod_{k\in\partial i\setminus j}\left[\sum_{\sigma_{ki}=1}^2\mu'_{k\to \Psi_i}(\sigma_{ki},\tau_i^{(k)},c_{ki}=0,t_i^{(k)})\right]\\
	+&\left.\phi(t_i^{(j)})a(t_i^{(j)}-t_j^{(i)})\delta_{x_i^0,S}\mathbb{I}[\tau_i^{(j)}<\theta]\mathbb{I}[\sigma_{ji}=2]\prod_{k\in\partial i\setminus j}\mu'_{k\to \Psi_i}(\sigma_{ki}=2,\tau_i^{(k)},c_{ki}=0,t_i^{(k)})\right)
\end{aligned}
\end{align}
The second BP equation becomes:
\begin{align}
\label{eq:BP_variable_to_factor}
\left\{
\begin{array}{llllll}
	\mu'(0,\tau_j^{(i)},c_{ij},t_j^{(i)})&=\mathbb{I}[\tau_j-s_{ji}>0]\sum_{t_i^{(j)}}a(t_j^{(i)}-t_i^{(i)}-c_{ij})\sum_{\tau_i^{(j)}=0}^{\tau_j^{(i)}-s_{ji}}\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)},\sigma_{ji}=2,t_i^{(j)},t_j^{(i)}) \\
	\mu'(1,\tau_j^{(i)},c_{ij},t_j^{(i)})&= \mathbb{I}[\tau_j-s_{ji}\geq 0]\sum_{t_i^{(j)}}a(t_j^{(i)}-t_i^{(i)}-c_{ij})\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)}=\tau_j^{(i)}-s_{ji},\sigma_{ji}=2,t_i^{(j)},t_j^{(i)})\\	
	\mu'(2,\tau_j^{(i)},c_{ij},t_j^{(i)})&=\sum_{t_i^{(j)}}a(t_j^{(i)}-t_i^{(i)}-c_{ij})\left[\sum_{\tau_i^{(j)}=\zeta^+_i}^{\zeta^-_i}\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)},\sigma_{ji}=2,t_i^{(j)},t_j^{(i)})\right. \\
	&+ \mathbb{I}[\tau_j^{(i)}+s_{ji}\leq \theta]\tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)}=\tau_j^{(i)}+s_{ji},\sigma_{ji}=1,t_i^{(j)},t_j^{(i)})\\
	&+\left. \mathbb{I}[\tau_j^{(i)}+s_{ji}<\theta]\sum_{\tau_i^{(j)}=\tau_j^{(i)}+s_{ji}+1}^\theta \tilde{\nu}_{\Psi_i\to j}(\tau_i^{(j)},\sigma_{ji}=0,t_i^{(j)},t_j^{(i)})\right]	
\end{array}
\right.
\end{align}

\subsection{BP marginals}
Once a fixed-point of the BP equations~(\ref{eq:BP_factor_to_variable},\ref{eq:BP_variable_to_factor}) is found, the BP marginal can be expressed as:
\begin{align}
\label{eq:BP_marginal}
\begin{aligned}
	P_i(\tau_i, t_i) &= \sum_{\underline{\tau}_{\partial i},\underline{t}_{\partial i}}P_{\Psi_i}(\tau_i, t_i, \underline{\tau}_{\partial i},\underline{t}_{\partial i}) \\
	&= \frac{1}{Z_{\Psi_i}}\sum_{\underline{\tau}_{\partial i},\underline{t}_{\partial i}}\xi(\tau_i, t_i;c_i)\psi^*(\tau_i, \underline{\tau}_{\partial_i};\{s_{li}\}_{l\in\partial i},x_i^0)\psi(t_i,\underline{t}_{\partial i})\prod_{l\in\partial i}\mu_{l\to\Psi_i}(\tau_i, \tau_l,t_i, t_l) \\
	&= \frac{1}{Z_{\Psi_i}}\gamma(t_i)\xi(\tau_i, t_i; c_i) \left(\delta_{x_i^0,I}\delta_{\tau_i,0}\prod_{l\in\partial i}\left[\sum_{\sigma_{li}=0}^2\mu_{l\to\Psi_i}(\sigma_{ki}, \tau_i, c_{ki}=1, t_i)\right]\right. \\
	+& \delta_{x_i^0,S}\prod_{l\in\partial i}\left[\sum_{\sigma_{li}=1}^2\mu_{l\to \Psi_i}(\sigma_{li}, \tau_i, c_{li}=1, t_i)\right] \\
	-& \delta_{x_i^0,S}\mathbb{I}[\tau_i<\theta]\prod_{l\in\partial i}\mu_{l\to \Psi_i}(\sigma_{li}=2, \tau_i, c_{li}=1, t_i) \\
	-&\phi(t_i)\delta_{x_i^0,I}\delta_{\tau_i,0}\prod_{l\in\partial i}\left[\sum_{\sigma_{li}=0}^2\mu_{l\to\Psi_i}(\sigma_{ki}, \tau_i, c_{ki}=0, t_i)\right]\\
	-&\phi(t_i)\delta_{x_i^0,S}\prod_{l\in\partial i}\left[\sum_{\sigma_{li}=1}^2\mu_{l\to \Psi_i}(\sigma_{li}, \tau_i, c_{li}=0, t_i)\right]\\
	+&\left.\phi(t_i) \delta_{x_i^0,S}\mathbb{I}[\tau_i<\theta]\prod_{l\in\partial i}\mu_{l\to \Psi_i}(\sigma_{li}=2, \tau_i, c_{li}=0, t_i)\right)
\end{aligned}
\end{align}

\section{Replica Symmetric Formalism} 
The aim of the cavity method is to characterize the typical properties of the probability measure:
\begin{align}
\label{eq:prob_auxiliary}
P(\{T_{ij}\}_{(ij)\in E}|\mathcal) &= \frac{1}{\mathcal{Z}(\mathcal{D})}\prod_{i\in V}\Psi(\{T_{il}\}_{l\in\partial i};\mathcal{D}_i) \ ,
\end{align}
for typical random graphs in the thermodynamic limit $N\to\infty$, and for typical realization of the disorder $\mathcal{D}$.
In the simplest version of the cavity method, called Replica Symmetric (RS), one assumes a fast decay of the correlations between distant variables in the measure (\ref{eq:prob_auxiliary}), in such a way that the BP equations:
\begin{align}
\label{eq:BP_equations}
\begin{aligned}
\mu_{i\to \Psi_j}(T_{ij}) &= \frac{1}{z_{\Psi_i\to j}}\sum_{\{T_{il}\}_{k\in\partial i \setminus j}}\Psi(\{T_{il}\}_{l\in\partial i};\mathcal{D}_i)\prod_{k\in\partial i \setminus j}\mu_{k\to\Psi_i}(T_{ik})
\end{aligned}
\end{align}
converge to a unique fixed-point on a typical large instance, and that the measure (\ref{eq:prob_auxiliary}) is well described by the locally tree-like approximation.
We consider a uniformly chosen edge $(ij)\in E$ in a random contact graph $\mathcal{G}$, and call $\mathcal{P}^{\rm rs}$ the probability law of the fixed-point BP message $\mu_{i\to \Psi_j}$ thus observed.
Within the decorrelation hypothesis of the RS cavity method, the incoming messages on a given factor node are $i.i.d.$ with probability $\mathcal{P}^{\rm rs}$.
This implies that the probability law $\mathcal{P}^{\rm rs}$ must obey the following self-consistent equation:
	\begin{align}
	\mathcal{P}^{\rm rs}(\mu) = \sum_{d=0}^\infty r_d\sum_{x^0}\gamma(x^0)\sum_c p(c)\sum_{s_1,\dots,s_d}\prod_{i=1}^dw(s_i)\int\prod_{i=1}^d{\rm d}P^{\rm rs}(\mu_i)\delta(\mu - f^{\rm bp}(\mu_1,\dots,\mu_d;x^0,c,s_1,\dots,s_d))
	\end{align}
where $f^{\rm bp}(\mu_1,\dots,\mu_d;x^0,c,s_1,\dots,s_d)$ is a shorthand notation for the r.h.s. of equation (\ref{eq:BP_equations}).

\subsection{Numerical resolution of the replica-symmetric equations}	
We numerically solved these equations with population dynamics.
Using the above simplifications, we are left with two types of BP messages: $\mu'_{i\to\Psi_j}$ is defined over the variable $((\sigma_{ij},\tau_j^{(i)},c_{ij},t_j^{(i)}))$ living in a space of size $6(\theta+1)^2$, and $\tilde{\nu}_{\Psi_i\to j}$ is defined over the variable $(\tau_i^{(j)},\sigma_{ji},t_i^{(j)},t_j^{(i)})$, living in a space of size $3(\theta+1)^3$.
We store only the population of messages $\mu_{i\to \Psi_j}$.


\section{Bethe Free Energy}
\subsection{Expression in terms of BP messages}
\subsubsection{On a single instance}
The Bethe Free energy is written:
\begin{align}
\begin{aligned}
	F = -\sum_{i\in V}\log Z_{\Psi_i} + \frac{1}{2}\sum_{i\in V}\sum_{j\in\partial i}\log Z_{ij}
\end{aligned}
\end{align}
where $Z_{\Psi_i}$ is the normalisation of the BP marginal written above, and with:
\begin{align}
\begin{aligned}
	Z_{ij} &= \sum_{T_{ij}}\nu_{\Psi_i\to j}(T_{ij})\nu_{\Psi_j\to i}(T_{ij}) \\
	&= \sum_{T_{ij}}\nu_{\Psi_i\to j}(T_{ij})\mu_{j\to \Psi_i}(T_{ij}) \\
	&= \frac{1}{z_{\Psi_i\to j}}\sum_{\{T_{il}\}_{l\in\partial i}}\Psi(\{T_{il}\}_{l\in\partial i})\prod_{l\in\partial i}\mu_{l\to \Psi_i}(T_{il}) \\
	&= \frac{Z_{\Psi_i}}{z_{\Psi_i\to j}}
\end{aligned}
\end{align}
Where $z_{\Psi_i\to j}$ is the normalization of the BP message $\nu_{\Psi_i\to j}$:
\begin{align}
\begin{aligned}
	z_{\Psi_i\to j} &= \sum_{\{T_{il}\}_{l\in\partial i}}\Psi(\{T_{il}\}_{l\in\partial i})\prod_{k\in\partial i\setminus j}\mu_{k\to \Psi_i}(T_{ik}) \\
	&= \sum_{\tau_i^{(j)},\tau_j^{(i)},t_i^{(j)},t_j^{(i)}}\tilde{\nu}(\tau_i^{(j)},\sigma_{ji}=1+{\rm sgn}(\tau_j^{(i)}+s_{ji}-\tau_i^{(j)}), t_i^{(j)},t_j^{(i)})
\end{aligned}
\end{align}
where $\tilde{\nu}$ is the un-normalized message defined in~(\ref{eq:tilde_nu}).
We obtain an expression of the free-energy in terms of the normalisations $Z_{\Psi_i}$, $z_{\Psi_i\to j}$:
\begin{align}
	F = \frac{1}{N}\sum_{i\in V}\left(\frac{d_i}{2}-1\right)\log Z_{\Psi_i} - \frac{1}{N}\frac{1}{2}\sum_{i\in V}\sum_{j\in\partial i}\log z_{\Psi_i\to j}
\end{align}

\subsubsection{Replica-Symmetric Free Energy}
Once averaged over the graph and disorder, the Replica Symmetric prediction for the free-energy is:
\begin{align}
\begin{aligned}
	F^{\rm RS} &= \sum_d p_d \left(\frac{d}{2}-1\right)\sum_cp(c)\sum_{x}\gamma(x)\prod_{i=1}^dw(s_i)\int\prod_{l=1}^d{\rm d}\mathcal{P}^{\rm RS}(\mu_l)\log Z_{\Psi_i}(\mu_1,\dots,\mu_d;x,c,s_1,\dots,s_d) \\
	&-\frac{d_{\rm av}}{2}\sum_dr_d\sum_{x}\gamma(x)\sum_cp_c\sum_{s_1,\dots,s_d}\prod_{k=1}^dw(s_k)\int\prod_{k=1}^d{\rm d}\mathcal{P}^{\rm RS}(\mu_k)\log z_{\Psi_i\to j}(\mu_1,\dots,\mu_d;x,c,s_1,\dots,s_d)
\end{aligned}
\end{align}

\subsection{Derivative of the free-energy}

\section{Observables}
Describe AUC, $L_1$, Least mean square ($L_2$) and Overlap for each individual, for each time.
\subsection{Full trajectory in time}
We measure the overlap $O(\underline{t},\underline{\tau}) = \frac{1}{N}\sum_{i=1}^N\delta_{t_i,\tau_i}$, averaged over the joint distribution on planted and inferred times:
$
	\langle O(\underline{\tau}, \underline{t})\rangle_{P(\underline{\tau}, \underline{t}|\mathcal{D})} = \frac{1}{N}\sum_{i=1}^N\sum_{t'}P_i(\tau_i=t',t_i=t')
$
with $P_i$ the BP marginal obtained in~(\ref{eq:BP_marginal}).
Once averaged over the graph and disorder $\mathcal{D}$, the RS prediction is:
\begin{align}
	\mathbb{E}_{\mathcal{G},\mathcal{D}}\langle O\rangle =\sum_{t'}\overline{P}(\tau=t',t=t')
\end{align}
where $\overline{P}(\tau, t) = \int {\rm d} \mathcal{P}^{\rm RS}(P)P(\tau, t)$ is the BP marginal averaged over the RS distribution $\mathcal{P}^{\rm RS}(P)$

\subsection{Estimators}
Define $P_{i,t}(x_i^{*,t},x_i^t)$ the marginal probability of planted state $x_i^{*,t}$ and inferred state $x_i^t$ of one individual $i\in V$ at a given time $t\in\{0,1,\dots,\theta\}$.

\subsubsection{Maximum Mean Overlap}
The overlap at a given time $t$ is $O_t(\underline{x}^{*,t},\underline{x}^t) = \frac{1}{N}\sum_{i=1}^N\delta_{x_i^{*,t},x_i^t}$. Once averaged over the joint distribution on planted and inferred times: $\langle O_t(\underline{x}^{*,t},\underline{x}^t)\rangle = \frac{1}{N}\sum_{i=1}^N\sum_x P_{i,t}(x_i^{*,t}=x,x_i^t=x)$. One can finally average over the graph and disorder to obtain the RS prediction for the mean overlap (MO): ${\rm MO}_t = \mathbb{E}_{\mathcal{G},\mathcal{D}}\langle O_t\rangle =\sum_{x'}\overline{P}_t(x^*=x',x=x')$.
To get the maximum mean overlap (MMO), we replace the average over the inferred state $x_i^t$ by its estimator:
\begin{align}
	\hat{x}_i^t = \underset{x_i^t}{\rm argmax}\{P_{i,t}(x_i^t|x_i^{*,t})\}
\end{align}
We obtain the MMO on a given graph $\mathcal{G}$ and for fixed disorder $\mathcal{D}$:
\begin{align}
\begin{aligned}
	{\rm MMO}_t &= \sum_{\underline{x}^{*,t}}P_{t}(\underline{x}^{*,t})O_t(\underline{x}^{*,t},\underline{\hat{x}}^t) \\
	&=\frac{1}{N}\sum_{i=1}^N\sum_{x_i^{*,t}}P_{i,t}(x_i^{*,t})\delta_{x_i^{*,t},\hat{x}_i^t}
\end{aligned}
\end{align} 
Note that the MMO estimator is usually defined with the marginal of $x_i^t$ over the posterior probability distribution conditioned on the observations $\mathcal{O}$, $P_i(x_i^t|\mathcal{O})$. 
In our case however, fixing the disorder $\mathcal{D}$ is sufficient to fix the planted configuration $\underline{\tau}$ and the full observation $\mathcal{O}$. 

\subsubsection{Minimum Mean Squared Error}
The squared error (SE) at a given time $t$ is ${\rm SE}_t(\underline{x}^{*,t},\underline{x}) = \frac{1}{N}\sum_{i=1}^N(x_i^{*,t}-x_i)^2$. The mean squared error (MSE) on a given instance is given by:
\begin{align}
	{\rm MSE}_t(\underline{x}^t) = \frac{1}{N}\sum_{i=1}^N\sum_{x_i^{*,t}}P_{i,t}(x_i^{*,t})(x_i^{*,t}-x_i^t)^2
\end{align}
To get the minimum mean squared error (MMSE), we consider its estimator:
\begin{align}
\begin{aligned}
	\hat{x}_i^t &= \sum_{x_i^t}P_{i,t}(x_i^t|x_i^*)x_i^t \\
	{\rm MMSE}_t &= {\rm MSE}_t(\underline{\hat{x}}^t)
\end{aligned}
\end{align}

\subsection{Area Under the Curve (AUC)}

On a single instance, the receiver operating characteristic (ROC) curve is computed as follows. At a fixed time $t$, one computes for each individual its marginal probability $P_i(x_i^t=I|\mathcal{O})$. For a given threshold $\rho\in[0,1]$, the true positive rate TPR($\rho$) (resp. false positive rate FPR($\rho$)) is the fraction of positive (resp. negative) individuals with $P_i(x_i^t=I|\mathcal{O})\geq \rho$. The ROC curve is the parametric plot of TPR($\rho$) versus FPR($\rho$), with $\rho$ the varying parameter. Note that the FNR (and therefore the ROC curve) is undefined when all individuals are infected (all positive).

The area under the curve (AUC) can be interpreted as the probability that, picking one positive individual $i$ and one negative individual $j$, their marginal probabilities allows to tell which is positive and which one is negative, i.e. that $P_i(x_i^t=I|\mathcal{O}) > P_j(x_j^t=I|\mathcal{O})$.

\bibliography{../draft}

\end{document}
